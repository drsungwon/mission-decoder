#  Mission Python - Log Decryption Utility 🔐

![alt text](https://img.shields.io/badge/python-3.9+-blue.svg)
![alt text](https://img.shields.io/badge/managed%20with-Poetry-blueviolet.svg)
![alt text](https://img.shields.io/pypi/v/cryptography.svg)
![alt text](https://img.shields.io/badge/license-MIT-blue.svg)

**`mission-python` 프레임워크에서 생성된 암호화된 로그 및 시스템 서명을 복호화하는 공식 커맨드 라인 유틸리티입니다.** <br>
*The official command-line utility for decrypting logs and system signatures generated by the `mission-python` framework.*

---

## 🚀 프로젝트 개요 (Overview)

`mission-python` 프로젝트는 학생들의 과제 수행 과정을 안전하게 기록하기 위해 모든 로그(`log.encrypted`)와 시스템 정보(`signature.encrypted`)를 **하이브리드 암호화(RSA + AES)** 방식으로 저장합니다. 이 데이터는 평가자 또는 관리자의 **개인키(Private Key)** 없이는 절대로 열어볼 수 없습니다.

본 `mission-decoder` 유틸리티는 이 개인키를 사용하여 암호화된 바이너리 파일을 사람이 읽을 수 있는 평문(Plaintext) 텍스트 파일로 변환하는 역할을 수행합니다.

## ✨ 주요 기능 (Key Features)

- **강력한 보안**: 업계 표준인 RSA-2048 및 AES-256 암호화 체계를 완벽하게 지원합니다.
- **청크 단위 처리**: 파일 전체가 아닌, 여러 개의 암호화된 데이터 조각(Chunk)으로 구성된 로그 파일을 순차적으로 안전하게 복호화합니다.
- **명확한 CLI 인터페이스**: `cargo`와 유사한 직관적인 상태 메시지를 통해 복호화 과정의 각 단계를 명확하게 보여줍니다.
- **독립 실행 가능**: `mission-python` 프로젝트와는 별개의 독립적인 도구로, 필요한 환경에서 간편하게 사용할 수 있습니다.

## 🛠️ 시작하기 (Getting Started)

### 사전 요구사항 (Prerequisites)

- [Python](https://www.python.org/downloads/) (3.9 이상 권장)
- [Poetry](https://python-poetry.org/docs/#installation) (패키지 및 의존성 관리 도구)
- Git

### 설치 및 설정 (Installation)

1.  **프로젝트 복제 (Clone)**

    ```bash
    git clone [your-repository-url]
    cd mission-decoder
    ```

2.  **의존성 설치 (Install Dependencies)**

    `Poentry`를 사용하여 필요한 라이브러리(`cryptography`)를 설치합니다. 이 과정에서 가상 환경이 자동으로 생성됩니다.

    ```bash
    poetry install
    ```

3.  **🔑 개인키 준비 (Prepare Your Private Key)**

    복호화를 위해 제공된 **RSA 개인키 파일** (예: `private_key.pem`)을 프로젝트 내 안전한 위치에 준비해야 합니다. `keys` 디렉토리를 만들어 관리하는 것을 권장합니다.

    ```
    mission-decoder/
    ├── keys/
    │   └── private_key.pem  <-- 여기에 개인키를 위치시키세요.
    └── src/
        └── ...
    ```

    > ⚠️ **보안 경고**: 개인키 파일은 절대 외부에 노출되거나 Git 저장소에 커밋해서는 안 됩니다. 프로젝트의 `.gitignore` 파일에 `keys/` 디렉토리를 추가하여 실수로 커밋되는 것을 방지하세요.

## 💻 사용 방법 (Usage)

복호화는 터미널에서 다음 명령어를 통해 실행합니다. 총 3개의 인자(입력 파일, 개인키, 출력 파일)가 필요합니다.

### 명령어 형식

```bash
poetry run python -m mission_decoder.main [INPUT_FILE] [PRIVATE_KEY] [OUTPUT_FILE]
```

-   `INPUT_FILE`: 복호화할 암호화된 파일 경로 (예: `log.encrypted`).
-   `PRIVATE_KEY`: 복호화에 사용할 개인키 파일 경로 (예: `keys/private_key.pem`).
-   `OUTPUT_FILE`: 복호화된 내용이 저장될 파일 경로 (예: `decrypted_log.txt`).

### 실행 예시

```bash
poetry run python -m mission_decoder.main \
    ../mission-python/src/mission_python/log/log.encrypted \
    ./keys/private_key.pem \
    ./output/decrypted_log.txt
```

### 성공 시 출력 예시

```
[  INFO   ] 암호화된 로그 복호화 프로세스를 시작합니다...
             - 입력 파일: /path/to/mission-python/src/mission_python/log/log.encrypted
             - 개인키:    /path/to/mission-decoder/keys/private_key.pem
             - 출력 파일: /path/to/mission-decoder/output/decrypted_log.txt

[ STEP 1  ] 개인키 파일을 로딩합니다...
[   OK    ] 개인키 로딩 성공.
[ STEP 2  ] 'log.encrypted' 파일 처리를 시작합니다...
[   ...   ] 청크 #1 복호화 중...
[   ...   ] 청크 #2 복호화 중...
...
[   ...   ] 청크 #N 복호화 중...
[ STEP 3  ] './output/decrypted_log.txt' 파일에 결과를 저장합니다...
[ SUCCESS ] 총 N개의 청크를 성공적으로 복호화했습니다.
```

## ⚙️ 동작 원리: 암호화된 파일의 구조

`log.encrypted`와 같은 파일은 단순한 암호문이 아니라, 아래 구조를 가진 여러 개의 **청크(Chunk)**가 연속적으로 이어진 바이너리 파일입니다.

```
[ Chunk 1 ] [ Chunk 2 ] [ Chunk 3 ] ...
```

각각의 청크는 다음과 같은 세 부분으로 구성됩니다.

| 부분 (Block)               | 크기 (Bytes)    | 설명                                                               |
| -------------------------- | --------------- | ------------------------------------------------------------------ |
| **RSA Encrypted Session Key** | `256`           | RSA 공개키로 암호화된 `AES 키 + IV`. 개인키로만 해독 가능.           |
| **AES Data Length**        | `4`             | 뒤따라오는 암호화된 데이터의 정확한 길이. (빅엔디안 4바이트 정수)  |
| **AES Encrypted Data**     | *가변 (Variable)* | AES-256으로 암호화된 실제 데이터. (로그, 시스템 정보 등)            |

복호화 유틸리티는 파일을 순서대로 읽으며 이 청크 구조를 하나씩 파싱하고, 각 청크마다 다음의 과정을 반복하여 원본 데이터를 복원합니다.

1.  **세션키 복호화**: `RSA Block`을 개인키로 복호화하여 임시 `AES 키`와 `IV`를 얻습니다.
2.  **데이터 복호화**: 위에서 얻은 `AES 키`와 `IV`를 사용하여 `AES Block`을 복호화합니다.
3.  **패딩 제거**: 복호화된 데이터에서 PKCS7 패딩을 제거하여 순수한 원본 데이터를 얻습니다.
4.  **데이터 병합**: 복원된 데이터를 최종 결과 버퍼에 추가합니다.
5.  파일의 끝에 도달할 때까지 위 과정을 반복합니다.

## 📄 라이선스 (License)

이 프로젝트는 [MIT](LICENSE) 라이선스를 따릅니다.